# 地图拼接方式

## 一、基础组件定义

>   基础组件由美术制作并以prefab的方式保存，在生成地图时将多个基础组件拼接形成地图。

1.  房间：它有一个或多个出口，只有在房间中会发生战斗（地形一定是平的）。
2.  走廊：连接房间之间的桥梁，拥有两个出口，可能是斜坡。
3.  连接器：一个或多个出口，可以理解为不发生战斗的房间。
>   连接器一般用于延长走廊、制造分叉路口或将走廊拐弯。
4.  装饰房：只用于装饰远景的房间，没有出口。

## 二、组建拼接关系

1.  房间只能连接走廊。
2.  走廊能连接房间或连接器。
3.  连接器只能连接走廊。
4.  装饰房无法连接。
>   在每个组件的出口，都有一个mark，标记了位置和旋转量，用于组件的匹配。

## 三、场景生成过程

1.  每个基础组件有自己的分数。
>   可以配置每个不同的基础组件的分数。

房间|分数|房间|分数|连接器|分数|装饰房|分数
-|-|-|-|-|-|-|-
大型房间|15|商店|4|四向连接器|3|大装饰房|10
中型房间|10|恶魔房|3|三向连接器|2|中装饰房|5
小型房间|7|附身房|2|双向连接器|1|小装饰房|2

2.  每个关卡初始会在范围内随机各组组件的分数总和。
>   房间类组件会根据需求拆分不同组。

房间|分数和|房间|分数和|连接器|分数和|装饰房|分数和
-|-|-|-|-|-|-|-
A类房间|80-120|B类房间|10-15|连接器|20-40|装饰房|50-70

3.  在分数内进行随机，会得到关卡内每个组件的实际数量。

房间|数量|房间|数量|连接器|数量|装饰房|数量
-|-|-|-|-|-|-|-
大型房间|3|商店|2|四向连接器|2|大装饰房|2
中型房间|2|恶魔房|0|三向连接器|3|中装饰房|4
小型房间|5|附身房|1|双向连接器|12|小装饰房|15

4.  初始化一个启动房间。
5.  为一个未连接的随机出口随机生成一个符合连接条件的模块。
>   连接后若出现房间交叉的情况，则不生成走廊。每个基础组件都可以视为矩形，会配置X/Z两个方向的长度。判断矩形间是否交叉，就能判断基础组件交叉的情况。
6.  重复执行步骤5，直到所有房间分配完成。
7.  选择距离启动房间最远的出口，连接BOSS房间。
>   若最远出口无法连接BOSS房间，则依次类推向距离更近的出口。
8.  在随机基础组件周围随机生成装饰房。
>   装饰房主要起远景效果，在对应基础组件周围寻找最近可安置的位置生成。


